{% extends "layout.html" %}
{% block content %}
<div class="container" style="max-width: 800px; margin: auto; padding: 20px;">
    <h2>Your Cart</h2>
    {% if cart %}
    <table style="width: 100%; border-collapse: collapse;">
        <tr style="background: #f2f2f2;">
            <th style="text-align:left; padding: 10px;">Product</th>
            <th>Price</th>
            <th>Quantity</th>
            <th>Subtotal</th>
            <th>Action</th>
        </tr>
        {% for item in cart %}
        <tr>
            <td style="padding: 10px 0;">{{ item.name }}</td>
            <td>${{ item.price }}</td>
            <td>
                {% if item.stock > 0 %}
                <form action="{{ url_for('update_cart', product_id=item.id) }}" method="POST" style="display:inline;">
                    <input type="number" name="quantity" value="{{ item.quantity }}" min="1" max="{{ item.stock }}" style="width:50px; text-align:center;">
                    <button type="submit" style="padding:4px 8px;">Update</button>
                </form>
                <div style="color: red; font-size: 12px;">
                    {% if item.quantity > item.stock %}
                        Only {{ item.stock }} left in stock!
                    {% endif %}
                </div>
                {% else %}
                    <span style="color:red; font-weight:bold;">Out of Stock</span>
                {% endif %}
            </td>
            <td>${{ '%.2f'|format(item.price * item.quantity) }}</td>
            <td>
                <form action="{{ url_for('remove_from_cart', product_id=item.id) }}" method="POST">
                    <button type="submit" style="color:white; background:red; padding:5px 10px; border-radius:4px; border:none;">Remove</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </table>
    <h3 style="margin-top: 20px;">Total: ${{ '%.2f'|format(total) }}</h3>

    <div style="margin-top: 20px;">
        <a href="{{ url_for('payment') }}" class="btn" style="background: green; color: white; padding: 10px 15px; border-radius: 4px; text-decoration:none;">Proceed to Payment</a>
        <a href="{{ url_for('clear_cart') }}" class="btn" style="background: red; color: white; padding: 10px 15px; border-radius: 4px; text-decoration:none;">Clear Cart</a>
    </div>
    {% else %}
    <p>Your cart is empty. <a href="{{ url_for('shop') }}">Go Shopping</a></p>
    {% endif %}
</div>
{% endblock %}
